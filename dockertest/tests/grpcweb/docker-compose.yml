services:
  # The web server to test
  ferron:
    build:
      context: ../../..
      dockerfile: Dockerfile.test
    volumes:
      - ./ferron.kdl:/etc/ferron.kdl

  # The backend server for testing
  backend:
    build:
      context: ./backend

  # The test proxy server for testing
  grpcweb-test-proxy:
    build:
      context: ./grpcweb-test-proxy
    environment:
      GRPCWEB_TEST_PROXY_LISTEN_ADDR: "0.0.0.0:8080"
      GRPCWEB_TEST_PROXY_BACKEND_URL: "http://ferron/"

  # A container to run tests
  test-runner:
    build:
      context: ../../runner
    command: "tail -f /dev/null"
